Geant4 Simulation for NEBULA-Xplorer Optics
This repository contains the Geant4 simulation and analysis scripts developed for the MSc thesis of Friso Eigenhuis. The project models the NEBULA-Xplorer X-ray optics to evaluate their performance and radiation hardness against the space proton environment.

The simulation is built using Geant4 version 11.3.1.

Project Overview
The primary goal of this simulation is to model the interaction of space protons with the NEBULA-Xplorer instrument. It analyzes how different X-ray mirror designs (concentrators) affect the proton flux and Total Ionizing Dose (TID) on the focal plane detector. The simulation results are then used to predict the end-of-life performance degradation of the detector, specifically the increase in leakage current and the resulting loss of energy resolution.

The simulation is highly configurable via macro files, allowing for easy selection of:

Mirror Geometry: Single Paraboloid (SP), Wolter-I (Paraboloid-Hyperboloid), or Double-Conic (DCC).
Proton Energy: The mono-energetic beam energy.
Component Toggles: Presence of a magnetic filter or a dumbbell-shaped opening in the mirror shell.
Simulation Code (src and include)
The C++ source code defines the Geant4 simulation environment, geometry, physics, and data acquisition.

thesis.cc: The main entry point of the application.

construction.cc: The core geometry class. It constructs the world volume, detector assembly, and dynamically places the selected mirror geometry.

constructionMessenger.cc: Creates UI commands (/det/mirrorType, /det/filterOn, etc.) to allow for run-time configuration of the geometry from a macro file.

Mirror Geometries:
mirror_single_paraboloid.cc: Implements a single-shell paraboloid optic (similar to NICER).
mirror_wolter1.cc: Implements a true Wolter-I optic with a paraboloid and a hyperboloid shell.
mirror_double_conic.cc: Implements a double-conic approximation of a Wolter-I optic.

physics.cc: Defines the physics list, utilizing G4EmStandardPhysics_option4 and registering the G4StepLimiter for precise simulation steps.

generator.cc & generatorMessenger.cc: Implements a particle gun that shoots protons onto the mirror aperture, configurable via UI commands.

User Actions:
runaction.cc: Manages the creation and saving of the output ROOT file containing the results n-tuple.

myeventaction.cc: Fills the n-tuple with event-summary data (e.g., total energy deposited).

mysteppingaction.cc: The core data-gathering class. At every particle step, it checks for reflections and records detailed information about the interaction.

mytrackingaction.cc & mytrajectory.cc: Implements custom trajectory tracking to store additional user-defined information, such as the number of reflections a particle has undergone.

Analysis Scripts (scripts)
These Python scripts process the ROOT files generated by the simulation to produce the final scientific results and plots.

Primary Analysis Scripts
calculate_flux.py: Calculates the total proton fluence at the detector for each configuration. It generates summary tables comparing the performance of different designs relative to a baseline.

calculate_tid.py: Calculates the Total Ionizing Dose (TID) in krad(Si) on the detector and focal plane. It also generates comparative tables and plots.

calculate_realistic_leakage.py: The most comprehensive analysis script. It integrates the simulated proton flux with NIEL (Non-Ionizing Energy Loss) data (kappa.csv) and detector physics to predict the 5-year increase in leakage current and the corresponding degradation in FWHM energy resolution. It produces the final performance plots.

Supporting & Visualization Scripts
analyze_reflections_all.py: Analyzes the reflection data stored in the ROOT files, plotting histograms of how many times protons reflect before hitting the detector for each mirror type.

plot_trajectories.py: Reads the stored trajectory data for a specific event and generates a 2D plot of the particle paths through the optics, excellent for visualization and debugging.

funnelling_efficiency_all.py: Calculates and plots the charge funnelling efficiency, a detector effect where charge generated by a particle strike is collected more efficiently than geometric area would suggest.

plot_kappa.py & projectedrange.py: Utility scripts to plot the input physics data for NIEL (kappa.csv) and proton stopping range (proton_stopping_range.csv).
