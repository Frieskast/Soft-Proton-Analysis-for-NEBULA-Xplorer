
INTRO:

This is the README for the Geant4 simulations produced in the MSc thesis of Friso Eigenhuis. The files consist of a validation scenario in exp_val folder. In this Geant4 simulation the experiment of Diebold et al. 2015, Soft proton scattering efficiency measurements on X-ray mirror shells, is adapted to validate the physics list that could model the reflection of protons at grazing angles on the gold surfaces of nested X-ray mirrors.

The main simulation is in the thesis folder, which models the NEBULA-Xplorer optics which is designed with a focal length of 0.8m, X-ray focussing optics, a FastSDD 70mm2 with C1 window from AMPTEK. By shooting protons into these optics the fluence on the detector can be estimated for the mission lifetime. The optics available in this model are a Single paraboloid (NICER), Wolter I paraboloid hyperboloid and the conic approximation.
The metrics that are saved and analysed are the amount of protons that end up at the detector, while tracking the trajectory, the amount of reflections and the material of reflection and the energy upon entering the detector etc.

The Geant4 version used is v11.3.1


In exp_val the following folders are included:
\src With all the source files
\scripts With all the python analysis scripts
\include With all the headers
\build with inside it another \build. Due to a unknown dependency I was unable to fix this bug.

Also included are a visualization and 4 run macros. The SS,03,04 run macros are physics list specific but the simulation is not dependend on it.

Simulation Code (src and include)
The C++ source code defines the Geant4 simulation environment, geometry, physics, and data acquisition.

thesis.cc: The main entry point of the application. It initializes the Geant4 Run Manager, sets up the user-defined classes, and starts the simulation.
construction.cc: Defines the experimental geometry. This includes the world volume, the gold-coated silicon mirror, and the detector plane, replicating the setup from the Diebold et al. experiment.

physics.cc: Implements the physics list. It registers the standard electromagnetic physics processes and allows for switching between different Multiple Scattering (MS) models (e.g., G4WentzelVIModel, G4CoulombScattering) which are crucial for accurately modeling proton scattering at grazing angles.

action.cc: The action initialization class. It is responsible for instantiating and registering all the user action classes (RunAction, GeneratorAction, SteppingAction).

generator.cc: Defines the primary particle generator. It creates a proton "gun" that can be controlled via UI commands to set the particle's energy, starting position, and incident angle relative to the mirror surface.

generatorMessenger.cc: Creates the custom UI commands (e.g., /gun/angle, /gun/energy) that allow the particle generator to be controlled from macro files (.mac).

runaction.cc: Manages actions at the beginning and end of each run. It is responsible for creating and managing the output ROOT file, including setting up the n-tuple (G4AnalysisManager) to store simulation results.

mysteppingaction.cc: The core of the data collection. This class is executed at every step a particle takes. It tracks key information, such as whether a proton has reflected off the mirror, its energy upon hitting the detector, and its final position.

detector.cc: Defines the properties of the sensitive detector. It specifies what happens when a particle enters the detector volume and is responsible for recording the "hits" that are later processed.

Analysis Scripts (scripts)
These Python scripts are used to process and analyze the ROOT files generated by the simulation.

angle_val_all.py: The primary validation script. It compares simulation results from three different physics lists (Single Scattering, MS opt3, MS opt4) against experimental data from all_efficiencies_combined.csv. It generates a plot for each energy/angle combination, calculates the chi-squared (χ²) value to quantify the goodness-of-fit for each model, and computes an overall systematic correction factor (C_eta).

angle_val.py: A simplified plotting script. It compares simulation results from a single physics list at different energies on one combined plot, without referencing experimental data. Useful for quick internal comparisons.

calculate_systematics.py: A focused script that reads simulation and experimental data to calculate the systematic correction factor (C_eta = η_exp / η_sim) and its uncertainty.

combine.py: A utility script used to merge multiple CSV data files into a single, combined file, such as all_efficiencies_combined.csv.

compute_chi2.py: A dedicated script for performing a chi-squared analysis between a set of simulation data and experimental data points.

compute.py: A general-purpose script for processing a directory of ROOT files to extract key metrics like efficiency and mean energy loss, saving the results to a CSV file for further analysis.

energy_val.py: Validates the simulated energy loss of protons against experimental data from all_energyLoss_combined.csv. It plots the measured vs. simulated energy loss as a function of scattering angle.

far_angle_val.py: A specialized version of angle_val.py designed to analyze scattering at larger, "far" angles, which are typically handled with lower statistics.

hadd_combine.py: A helper script that automates the process of merging multiple ROOT files using the hadd command, grouping them by energy and angle.

histo.py: A simple script to generate and display a histogram of a specific variable (e.g., edep) from a single ROOT file.

plot_errors.py: A diagnostic script to visualize the relative statistical and systematic errors from the experimental data CSV file.
